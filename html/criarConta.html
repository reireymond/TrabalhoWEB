<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Criar Conta - Hotel Fênix</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="../css/login.css" />
  </head>
  <body>
    <main class="container" role="main">
      <section class="hero" aria-labelledby="hero-title">
        <div class="logo-destaque">
          <img src="../img/logo.jpg" alt="Logo Hotel Fênix" />
          <h1 class="hotel-nome">Hotel Fênix</h1>
          <p class="hotel-subtitle">Sistema de Reservas</p>
        </div>
      </section>

      <aside class="card" aria-labelledby="login-title">
        <p id="login-title">Criar Conta</p>

        <form id="create-account-form">
          <div class="field">
            <label for="name">Nome Completo</label>
            <input
              id="name"
              type="text"
              placeholder="Digite seu nome"
              required
            />
          </div>

          <div class="field">
            <label for="cpf">CPF</label>
            <input id="cpf" type="text" placeholder="000.000.000-00" required />
          </div>

          <div class="field">
            <label for="telefone">Telefone</label>
            <input
              id="telefone"
              type="tel"
              placeholder="(00) 00000-0000"
              required
            />
          </div>

          <div class="field">
            <label for="email">E-mail</label>
            <input
              id="email"
              type="email"
              placeholder="Digite seu e-mail"
              required
            />
          </div>

          <div class="field">
            <label for="password">Senha</label>
            <input
              id="password"
              type="password"
              placeholder="Crie uma senha"
              required
            />
          </div>

          <div class="field">
            <label for="confirm-password">Confirmar Senha</label>
            <input
              id="confirm-password"
              type="password"
              placeholder="Confirme sua senha"
              required
            />
          </div>

          <button type="submit" class="btn">Criar Conta</button>

          <p class="small-note">
            Já tem conta?
            <a href="login.html" class="link">Entrar</a>
          </p>
        </form>
      </aside>
    </main>

    <div
      class="modal fade"
      id="modalVerificacao"
      tabindex="-1"
      aria-hidden="true"
      data-bs-backdrop="static"
    >
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content" style="color: #421f15">
          <div class="modal-header border-0">
            <h5 class="modal-title fw-bold">Confirmação de E-mail</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body text-center">
            <p>
              Enviamos um código de verificação para: <br />
              <strong id="email-destino" class="text-primary"></strong>
            </p>
            <p class="small text-muted">
              (Verifique o "alert" que apareceu na tela simulando o e-mail)
            </p>

            <div class="my-3">
              <input
                type="text"
                class="form-control text-center fs-4 letter-spacing-2"
                id="input-codigo"
                placeholder="000000"
                maxlength="6"
                style="letter-spacing: 5px; font-weight: bold"
              />
              <div class="invalid-feedback" id="feedback-erro">
                Código incorreto! Tente novamente.
              </div>
            </div>
          </div>
          <div class="modal-footer border-0 justify-content-center">
            <button
              type="button"
              class="btn w-100"
              id="btn-confirmar-codigo"
              style="margin-bottom: 0"
            >
              Verificar e Criar Conta
            </button>
          </div>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <script>
      function mascaraCPF(input) {
        let value = input.value.replace(/\D/g, "");
        if (value.length > 11) value = value.slice(0, 11);

        if (value.length > 9) {
          value = value.replace(
            /^(\d{3})(\d{3})(\d{3})(\d{1,2}).*/,
            "$1.$2.$3-$4"
          );
        } else if (value.length > 6) {
          value = value.replace(/^(\d{3})(\d{3})(\d{0,3}).*/, "$1.$2.$3");
        } else if (value.length > 3) {
          value = value.replace(/^(\d{3})(\d{0,3}).*/, "$1.$2");
        }
        input.value = value;
      }

      function mascaraTelefone(input) {
        let value = input.value.replace(/\D/g, "");
        if (value.length > 11) value = value.slice(0, 11);

        if (value.length > 10) {
          value = value.replace(/^(\d{2})(\d{5})(\d{4}).*/, "($1) $2-$3");
        } else if (value.length > 6) {
          value = value.replace(/^(\d{2})(\d{4})(\d{0,4}).*/, "($1) $2-$3");
        } else if (value.length > 2) {
          value = value.replace(/^(\d{2})(\d{0,5}).*/, "($1) $2");
        }
        input.value = value;
      }

      document.getElementById("cpf").addEventListener("input", function (e) {
        mascaraCPF(e.target);
      });

      document
        .getElementById("telefone")
        .addEventListener("input", function (e) {
          mascaraTelefone(e.target);
        });

      let codigoGerado = "";
      const modalVerificacao = new bootstrap.Modal(
        document.getElementById("modalVerificacao")
      );
      const inputCodigo = document.getElementById("input-codigo");

      document
        .getElementById("create-account-form")
        .addEventListener("submit", function (e) {
          e.preventDefault();

          const nome = document.getElementById("name").value;
          const cpf = document.getElementById("cpf").value;
          const email = document.getElementById("email").value;
          const pass = document.getElementById("password").value;
          const confirmPass = document.getElementById("confirm-password").value;

          if (pass !== confirmPass) {
            alert("As senhas não conferem!");
            return;
          }

          codigoGerado = Math.floor(100000 + Math.random() * 900000).toString();

          alert(
            `[SIMULAÇÃO DE SISTEMA]\n\nOlá, ${nome}!\nSeu código de verificação Hotel Fênix é: ${codigoGerado}`
          );

          document.getElementById("email-destino").textContent = email;
          inputCodigo.value = "";
          inputCodigo.classList.remove("is-invalid");
          modalVerificacao.show();
        });

      document
        .getElementById("btn-confirmar-codigo")
        .addEventListener("click", function () {
          if (inputCodigo.value === codigoGerado) {
            modalVerificacao.hide();
            
            const nome = document.getElementById("name").value;
            const cpf = document.getElementById("cpf").value;
            
            alert(`Conta verificada e criada com sucesso!\nBem-vindo(a), ${nome}.`);
            window.location.href = "../index.html";
          } else {
            inputCodigo.classList.add("is-invalid");
          }
        });
    </script>
  </body>
</html>
